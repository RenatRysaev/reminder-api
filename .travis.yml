sudo: required
language: node_js
node_js:
  - 10

services:
  - docker

addons:
  ssh_known_hosts:
    - 68.183.73.58

env:
  - DOCKER_COMPOSE_VERSION=1.25.4

script:
  - echo "build app"
#  - docker-compose -f docker-compose.prod.yml up -d --build

#before_deploy:
#  - openssl aes-256-cbc -K $encrypted_6f14f6d9e1b8_key -iv $encrypted_6f14f6d9e1b8_iv -in deploy_key.enc -out ~\/deploy_key -d
#  - eval "$(ssh-agent -s)"
#  - chmod 600 /tmp/deploy_rsa
#  - ssh-add /tmp/deploy_rsa
#  - echo -e "Host 68.183.73.58\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
#
#deploy:
#  provider: script
#  skip_cleanup: true
#  script: bash ./deploy.sh
#  on:
#    branch: master, dev

after_success:
  - openssl aes-256-cbc -K $encrypted_6f14f6d9e1b8_key -iv $encrypted_6f14f6d9e1b8_iv -in deploy_key.enc -out ~\/deploy_key -d
  - eval "$(ssh-agent -s)"
  - cp .travis/id_rsa ~/.ssh/deploy_key
  - chmod 600 ~/.ssh/deploy_key
  - ssh-add ~/.ssh/deploy_key
  - ssh deploy@68.183.73.58 "echo 'success connected' && exit"
